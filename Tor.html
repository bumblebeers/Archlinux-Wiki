<!DOCTYPE html>
<html class="client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-0 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-toc-available" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Tor - ArchWiki</title>
<link rel="stylesheet" href="../ArchWikiOffline.css">
<meta name="ResourceLoaderDynamicStyles" content="">
<meta name="generator" content="MediaWiki 1.43.3">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0">
<link rel="search" type="application/opensearchdescription+xml" href="/rest.php/v1/search" title="ArchWiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.archlinux.org/api.php?action=rsd">
<link rel="license" href="https://www.gnu.org/copyleft/fdl.html">
<link rel="alternate" type="application/atom+xml" title="ArchWiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin--responsive skin-vector skin-vector-search-vue mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Tor rootpage-Tor skin-vector-2022 action-view">
<a class="mw-jump-link" href="#bodyContent">Jump to content</a>
<div class="vector-header-container">
	</div>
<div class="mw-page-container">
	<div class="mw-page-container-inner">
		<div class="vector-column-start">
			<div class="vector-main-menu-container">
		</div>
	<div class="vector-sticky-pinned-container">
				<nav id="mw-panel-toc" aria-label="Contents" data-event-name="ui.sidebar-toc" class="mw-table-of-contents-container vector-toc-landmark">
					<div id="vector-toc-pinned-container" class="vector-pinned-container">
					<div id="vector-toc" class="vector-toc vector-pinnable-element">
	<div class="vector-pinnable-header vector-toc-pinnable-header vector-pinnable-header-pinned" data-feature-name="toc-pinned" data-pinnable-element-id="vector-toc">
	<h2 class="vector-pinnable-header-label">Contents</h2>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-toc.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-toc.unpin">hide</button>
</div>


	<ul class="vector-toc-contents" id="mw-panel-toc-list">
		<li id="toc-mw-content-text" class="vector-toc-list-item vector-toc-level-1">
			<a href="#" class="vector-toc-link">
				<div class="vector-toc-text">Beginning</div>
			</a>
		</li>
		<li id="toc-Installation" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Installation">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">1</span>
				<span>Installation</span>
			</div>
		</a>
		
		<ul id="toc-Installation-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Usage" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Usage">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">2</span>
				<span>Usage</span>
			</div>
		</a>
		
		<ul id="toc-Usage-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Configuration" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Configuration">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">3</span>
				<span>Configuration</span>
			</div>
		</a>
		
			<button aria-controls="toc-Configuration-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Configuration subsection</span>
			</button>
		
		<ul id="toc-Configuration-sublist" class="vector-toc-list">
			<li id="toc-Tor_ControlPort" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tor_ControlPort">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1</span>
					<span>Tor ControlPort</span>
				</div>
			</a>
			
			<ul id="toc-Tor_ControlPort-sublist" class="vector-toc-list">
				<li id="toc-Nyx" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Nyx">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.1</span>
					<span>Nyx</span>
				</div>
			</a>
			
			<ul id="toc-Nyx-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Set_a_Tor_Control_cookie_file" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Set_a_Tor_Control_cookie_file">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.2</span>
					<span>Set a Tor Control cookie file</span>
				</div>
			</a>
			
			<ul id="toc-Set_a_Tor_Control_cookie_file-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Set_a_Tor_Control_password" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Set_a_Tor_Control_password">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.3</span>
					<span>Set a Tor Control password</span>
				</div>
			</a>
			
			<ul id="toc-Set_a_Tor_Control_password-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Open_Tor_ControlSocket" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Open_Tor_ControlSocket">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.4</span>
					<span>Open Tor ControlSocket</span>
				</div>
			</a>
			
			<ul id="toc-Open_Tor_ControlSocket-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Testing" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Testing">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">3.1.5</span>
					<span>Testing</span>
				</div>
			</a>
			
			<ul id="toc-Testing-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Web_browsing" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Web_browsing">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">4</span>
				<span>Web browsing</span>
			</div>
		</a>
		
		<ul id="toc-Web_browsing-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-HTTP_proxy" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#HTTP_proxy">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">5</span>
				<span>HTTP proxy</span>
			</div>
		</a>
		
			<button aria-controls="toc-HTTP_proxy-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle HTTP proxy subsection</span>
			</button>
		
		<ul id="toc-HTTP_proxy-sublist" class="vector-toc-list">
			<li id="toc-Tor" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tor">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.1</span>
					<span>Tor</span>
				</div>
			</a>
			
			<ul id="toc-Tor-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Firefox" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Firefox">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.2</span>
					<span>Firefox</span>
				</div>
			</a>
			
			<ul id="toc-Firefox-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Privoxy" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Privoxy">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">5.3</span>
					<span>Privoxy</span>
				</div>
			</a>
			
			<ul id="toc-Privoxy-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Instant_messaging" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Instant_messaging">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">6</span>
				<span>Instant messaging</span>
			</div>
		</a>
		
			<button aria-controls="toc-Instant_messaging-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Instant messaging subsection</span>
			</button>
		
		<ul id="toc-Instant_messaging-sublist" class="vector-toc-list">
			<li id="toc-Pidgin" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Pidgin">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.1</span>
					<span>Pidgin</span>
				</div>
			</a>
			
			<ul id="toc-Pidgin-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Irssi" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Irssi">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">6.2</span>
					<span>Irssi</span>
				</div>
			</a>
			
			<ul id="toc-Irssi-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Pacman" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Pacman">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">7</span>
				<span>Pacman</span>
			</div>
		</a>
		
		<ul id="toc-Pacman-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Running_a_Tor_relay" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Running_a_Tor_relay">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">8</span>
				<span>Running a Tor relay</span>
			</div>
		</a>
		
			<button aria-controls="toc-Running_a_Tor_relay-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Running a Tor relay subsection</span>
			</button>
		
		<ul id="toc-Running_a_Tor_relay-sublist" class="vector-toc-list">
			<li id="toc-Running_a_Middle/Guard_relay" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_a_Middle/Guard_relay">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.1</span>
					<span>Running a Middle/Guard relay</span>
				</div>
			</a>
			
			<ul id="toc-Running_a_Middle/Guard_relay-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_a_Tor_bridge" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_a_Tor_bridge">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.2</span>
					<span>Running a Tor bridge</span>
				</div>
			</a>
			
			<ul id="toc-Running_a_Tor_bridge-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_a_Tor_exit_relay" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_a_Tor_exit_relay">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3</span>
					<span>Running a Tor exit relay</span>
				</div>
			</a>
			
			<ul id="toc-Running_a_Tor_exit_relay-sublist" class="vector-toc-list">
				<li id="toc-Configuration_2" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configuration_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.1</span>
					<span>Configuration</span>
				</div>
			</a>
			
			<ul id="toc-Configuration_2-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-+100Mbps_Exit_Relay_configuration_example" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#+100Mbps_Exit_Relay_configuration_example">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2</span>
					<span>+100Mbps Exit Relay configuration example</span>
				</div>
			</a>
			
			<ul id="toc-+100Mbps_Exit_Relay_configuration_example-sublist" class="vector-toc-list">
				<li id="toc-Tor_2" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Tor_2">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.1</span>
					<span>Tor</span>
				</div>
			</a>
			
			<ul id="toc-Tor_2-sublist" class="vector-toc-list">
				<li id="toc-Raise_maximum_number_of_open_file_descriptors" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Raise_maximum_number_of_open_file_descriptors">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.1.1</span>
					<span>Raise maximum number of open file descriptors</span>
				</div>
			</a>
			
			<ul id="toc-Raise_maximum_number_of_open_file_descriptors-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Start_tor.service_as_root_to_bind_Tor_to_privileged_ports" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Start_tor.service_as_root_to_bind_Tor_to_privileged_ports">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.1.2</span>
					<span>Start tor.service as root to bind Tor to privileged ports</span>
				</div>
			</a>
			
			<ul id="toc-Start_tor.service_as_root_to_bind_Tor_to_privileged_ports-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Tor_configuration" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Tor_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.1.3</span>
					<span>Tor configuration</span>
				</div>
			</a>
			
			<ul id="toc-Tor_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-iptables" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#iptables">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.2</span>
					<span>iptables</span>
				</div>
			</a>
			
			<ul id="toc-iptables-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-pdnsd" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#pdnsd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.3</span>
					<span>pdnsd</span>
				</div>
			</a>
			
			<ul id="toc-pdnsd-sublist" class="vector-toc-list">
				<li id="toc-Uncensored_DNS" class="vector-toc-list-item vector-toc-level-5">
			<a class="vector-toc-link" href="#Uncensored_DNS">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.3.1</span>
					<span>Uncensored DNS</span>
				</div>
			</a>
			
			<ul id="toc-Uncensored_DNS-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Ensuring_relay_is_working" class="vector-toc-list-item vector-toc-level-4">
			<a class="vector-toc-link" href="#Ensuring_relay_is_working">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">8.3.2.4</span>
					<span>Ensuring relay is working</span>
				</div>
			</a>
			
			<ul id="toc-Ensuring_relay_is_working-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
	</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Tor_DNS" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tor_DNS">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">9</span>
				<span>Tor DNS</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tor_DNS-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tor DNS subsection</span>
			</button>
		
		<ul id="toc-Tor_DNS-sublist" class="vector-toc-list">
			<li id="toc-Using_Tor_DNS_systemwide" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_Tor_DNS_systemwide">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">9.1</span>
					<span>Using Tor DNS systemwide</span>
				</div>
			</a>
			
			<ul id="toc-Using_Tor_DNS_systemwide-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Torsocks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Torsocks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">10</span>
				<span>Torsocks</span>
			</div>
		</a>
		
		<ul id="toc-Torsocks-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Transparent_Torification" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Transparent_Torification">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">11</span>
				<span>Transparent Torification</span>
			</div>
		</a>
		
		<ul id="toc-Transparent_Torification-sublist" class="vector-toc-list">
		</ul>
	</li>
	<li id="toc-Tips_and_tricks" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Tips_and_tricks">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">12</span>
				<span>Tips and tricks</span>
			</div>
		</a>
		
			<button aria-controls="toc-Tips_and_tricks-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Tips and tricks subsection</span>
			</button>
		
		<ul id="toc-Tips_and_tricks-sublist" class="vector-toc-list">
			<li id="toc-Kernel_capabilities" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Kernel_capabilities">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.1</span>
					<span>Kernel capabilities</span>
				</div>
			</a>
			
			<ul id="toc-Kernel_capabilities-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Using_system_tor_in_Tor_Browser" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Using_system_tor_in_Tor_Browser">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.2</span>
					<span>Using system tor in Tor Browser</span>
				</div>
			</a>
			
			<ul id="toc-Using_system_tor_in_Tor_Browser-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_Tor_in_a_chroot" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_Tor_in_a_chroot">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.3</span>
					<span>Running Tor in a chroot</span>
				</div>
			</a>
			
			<ul id="toc-Running_Tor_in_a_chroot-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Running_Tor_in_a_systemd-nspawn_container_with_a_virtual_network_interface" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Running_Tor_in_a_systemd-nspawn_container_with_a_virtual_network_interface">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4</span>
					<span>Running Tor in a systemd-nspawn container with a virtual network interface</span>
				</div>
			</a>
			
			<ul id="toc-Running_Tor_in_a_systemd-nspawn_container_with_a_virtual_network_interface-sublist" class="vector-toc-list">
				<li id="toc-Host_installation_and_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Host_installation_and_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4.1</span>
					<span>Host installation and configuration</span>
				</div>
			</a>
			
			<ul id="toc-Host_installation_and_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Virtual_network_interface" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Virtual_network_interface">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4.2</span>
					<span>Virtual network interface</span>
				</div>
			</a>
			
			<ul id="toc-Virtual_network_interface-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Start_and_enable_systemd-nspawn" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Start_and_enable_systemd-nspawn">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4.3</span>
					<span>Start and enable systemd-nspawn</span>
				</div>
			</a>
			
			<ul id="toc-Start_and_enable_systemd-nspawn-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Container_configuration" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Container_configuration">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4.4</span>
					<span>Container configuration</span>
				</div>
			</a>
			
			<ul id="toc-Container_configuration-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Start_and_enable_systemd-networkd" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Start_and_enable_systemd-networkd">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4.5</span>
					<span>Start and enable systemd-networkd</span>
				</div>
			</a>
			
			<ul id="toc-Start_and_enable_systemd-networkd-sublist" class="vector-toc-list">
			</ul>
		</li>
		<li id="toc-Configure_Tor" class="vector-toc-list-item vector-toc-level-3">
			<a class="vector-toc-link" href="#Configure_Tor">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.4.6</span>
					<span>Configure Tor</span>
				</div>
			</a>
			
			<ul id="toc-Configure_Tor-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
		</li>
		<li id="toc-Java" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Java">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">12.5</span>
					<span>Java</span>
				</div>
			</a>
			
			<ul id="toc-Java-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-Troubleshooting" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#Troubleshooting">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">13</span>
				<span>Troubleshooting</span>
			</div>
		</a>
		
			<button aria-controls="toc-Troubleshooting-sublist" class="cdx-button cdx-button--weight-quiet cdx-button--icon-only vector-toc-toggle">
				<span class="vector-icon mw-ui-icon-wikimedia-expand"></span>
				<span>Toggle Troubleshooting subsection</span>
			</button>
		
		<ul id="toc-Troubleshooting-sublist" class="vector-toc-list">
			<li id="toc-Tor_Browser_proxy_problems" class="vector-toc-list-item vector-toc-level-2">
			<a class="vector-toc-link" href="#Tor_Browser_proxy_problems">
				<div class="vector-toc-text">
					<span class="vector-toc-numb">13.1</span>
					<span>Tor Browser proxy problems</span>
				</div>
			</a>
			
			<ul id="toc-Tor_Browser_proxy_problems-sublist" class="vector-toc-list">
			</ul>
		</li>
	</ul>
	</li>
	<li id="toc-See_also" class="vector-toc-list-item vector-toc-level-1">
		<a class="vector-toc-link" href="#See_also">
			<div class="vector-toc-text">
				<span class="vector-toc-numb">14</span>
				<span>See also</span>
			</div>
		</a>
		
		<ul id="toc-See_also-sublist" class="vector-toc-list">
		</ul>
	</li>
</ul>
</div>

					</div>
		</nav>
			</div>
		</div>
		<div class="mw-content-container">
			<main id="content" class="mw-body" style="margin: 0">
				<header class="mw-body-header vector-page-titlebar">
					<nav aria-label="Contents" class="vector-toc-landmark">
						
<div id="vector-page-titlebar-toc" class="vector-dropdown vector-page-titlebar-toc vector-button-flush-left">
	<input type="checkbox" id="vector-page-titlebar-toc-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-vector-page-titlebar-toc" class="vector-dropdown-checkbox " aria-label="Toggle the table of contents">
	<label id="vector-page-titlebar-toc-label" for="vector-page-titlebar-toc-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--icon-only " aria-hidden="true"><span class="vector-icon mw-ui-icon-listBullet mw-ui-icon-wikimedia-listBullet"></span>

<span class="vector-dropdown-label-text">Toggle the table of contents</span>
	</label>
	<div class="vector-dropdown-content">


							<div id="vector-page-titlebar-toc-unpinned-container" class="vector-unpinned-container">
			</div>
		
	</div>
</div>

					</nav>
					<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Tor</span></h1>
							
<div id="p-lang-btn" class="vector-dropdown mw-portlet mw-portlet-lang">
	<input type="checkbox" id="p-lang-btn-checkbox" role="button" aria-haspopup="true" data-event-name="ui.dropdown-p-lang-btn" class="vector-dropdown-checkbox mw-interlanguage-selector" aria-label="Go to an article in another language. Available in 4 languages">
	<label id="p-lang-btn-label" for="p-lang-btn-checkbox" class="vector-dropdown-label cdx-button cdx-button--fake-button cdx-button--fake-button--enabled cdx-button--weight-quiet cdx-button--action-progressive mw-portlet-lang-heading-4" aria-hidden="true"><span class="vector-icon mw-ui-icon-language-progressive mw-ui-icon-wikimedia-language-progressive"></span>

<span class="vector-dropdown-label-text">4 languages</span>
	</label>
	<div class="vector-dropdown-content">

		<div class="vector-menu-content">
			
			<ul class="vector-menu-content-list">
				
				<li class="interlanguage-link interwiki-de mw-list-item"><a href="https://wiki.archlinux.de/title/Tor" title="Tor – Deutsch" lang="de" hreflang="de" data-title="Tor" data-language-autonym="Deutsch" data-language-local-name="Deutsch" class="interlanguage-link-target"><span>Deutsch</span></a></li>
<li class="interlanguage-link interwiki-ja mw-list-item"><a href="https://wiki.archlinux.jp/index.php/Tor" title="Tor – 日本語" lang="ja" hreflang="ja" data-title="Tor" data-language-autonym="日本語" data-language-local-name="日本語" class="interlanguage-link-target"><span>日本語</span></a></li>
<li class="interlanguage-link interwiki-ru mw-list-item"><a href="../ru/Tor.html" title="Tor – русский" lang="ru" hreflang="ru" data-title="Tor" data-language-autonym="Русский" data-language-local-name="русский" class="interlanguage-link-target"><span>Русский</span></a></li>
<li class="interlanguage-link interwiki-zh-hans mw-list-item"><a href="https://wiki.archlinuxcn.org/wiki/Tor" title="Tor – 中文（简体）" lang="zh-Hans" hreflang="zh-Hans" data-title="Tor" data-language-autonym="中文（简体）" data-language-local-name="中文（简体）" class="interlanguage-link-target"><span>中文（简体）</span></a></li>
			</ul>
			
		</div>

	</div>
</div>
</header>
				<div class="vector-column-end">
					<div class="vector-sticky-pinned-container">
						<nav class="vector-page-tools-landmark" aria-label="Page tools">
							<div id="vector-page-tools-pinned-container" class="vector-pinned-container">
				
							</div>
		</nav>
						<nav class="vector-appearance-landmark" aria-label="Appearance">
							<div id="vector-appearance-pinned-container" class="vector-pinned-container">
				<div id="vector-appearance" class="vector-appearance vector-pinnable-element">
	<div class="vector-pinnable-header vector-appearance-pinnable-header vector-pinnable-header-pinned" data-feature-name="appearance-pinned" data-pinnable-element-id="vector-appearance" data-pinned-container-id="vector-appearance-pinned-container" data-unpinned-container-id="vector-appearance-unpinned-container">
	<div class="vector-pinnable-header-label">Appearance</div>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-pin-button" data-event-name="pinnable-header.vector-appearance.pin">move to sidebar</button>
	<button class="vector-pinnable-header-toggle-button vector-pinnable-header-unpin-button" data-event-name="pinnable-header.vector-appearance.unpin">hide</button>
</div>


</div>

							</div>
		</nav>
					</div>
				</div>
				<div id="bodyContent" class="vector-body" aria-labelledby="firstHeading" data-mw-ve-target-container>
					<div class="vector-body-before-content">
							<div class="mw-indicators">
		</div>

						<div id="siteSub" class="noprint">From ArchWiki</div>
					</div>
					<div id="contentSub"><div id="mw-content-subtitle"></div></div>
					
					
					<div id="mw-content-text" class="mw-body-content">
<div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr">
<div class="archwiki-template-meta-related-articles">
<p>Related articles</p>
<ul>
<li><a href="../en/GNUnet.html" title="GNUnet">GNUnet</a></li>
<li><a href="../en/I2P.html" title="I2P">I2P</a></li>
<li><a href="../en/List_of_applications/Internet.html#Anonymizing_networks" class="mw-redirect" title="Freenet">Freenet</a></li>
</ul>
</div>
<p>The <a rel="nofollow" class="external text" href="https://www.torproject.org">Tor Project</a> (<i>T</i>he <i>o</i>nion <i>r</i>outing) is an open source implementation of <a href="https://en.wikipedia.org/wiki/Onion_routing" class="extiw" title="wikipedia:Onion routing">onion routing</a> that provides free access to an anonymous proxy network. Its primary goal is to enable <a href="https://en.wikipedia.org/wiki/Internet_anonymity" class="extiw" title="wikipedia:Internet anonymity">online anonymity</a> by protecting against <a href="https://en.wikipedia.org/wiki/Traffic_analysis" class="extiw" title="wikipedia:Traffic analysis">traffic analysis</a> attacks.
</p>
<p>Users of the Tor network run an onion proxy software on their machines, which presents a SOCKS interface to its clients. This software connects out to Tor, periodically negotiating a virtual circuit through the Tor network. Tor employs cryptography in a layered manner (hence the 'onion' analogy), ensuring forward secrecy between routers.
</p>
<p>Through this process the onion proxy manages networking traffic for end-user anonymity. It keeps a user anonymous by encrypting traffic, sending it through other nodes of the Tor network, and decrypting it at the last node to receive your traffic before forwarding it to the server you specified. One trade off is that using Tor can be considerably slower than a regular direct connection, due to the large amount of traffic re-routing. Additionally, although Tor provides protection against traffic analysis it cannot prevent traffic confirmation at the boundaries of the Tor network (i.e. the traffic entering and exiting the network). See <a href="https://en.wikipedia.org/wiki/Tor_(anonymity_network)" class="extiw" title="wikipedia:Tor (anonymity network)">Wikipedia:Tor (anonymity network)</a> for more information.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Tor by itself is <b>not</b> all you need to maintain anonymity. There are several major pitfalls to watch out for (see <a rel="nofollow" class="external text" href="https://support.torproject.org/#faq_staying-anonymous">Am I totally anonymous if I use Tor?</a>).</div>
<meta property="mw:PageProp/toc">
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=torbrowser-launcher">torbrowser-launcher</a></span> package to use the <a rel="nofollow" class="external text" href="https://www.torproject.org/download/">Tor Browser</a>, which is the only supported way to browse the web anonymously using Tor.
</p>
<p>Users intending to manually use Tor with other software, <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/">run relays</a>, or <a rel="nofollow" class="external text" href="https://community.torproject.org/onion-services/">host onion services</a> should install the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tor">tor</a></span> package. The majority of this article covers this usage.
</p>
<p><i>Nyx</i> is a command line monitor for Tor, it provides bandwidth usage, connection details and on-the-fly configuration editing. To use it, <a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nyx">nyx</a></span> package.
</p>
<h2><span class="mw-headline" id="Usage">Usage</span></h2>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>tor.service</code>. Alternatively, launch it manually as the tor user: 
</p>
<pre>[tor]$ /usr/bin/tor
</pre>
<p>To use a program over Tor, configure it to use <code>127.0.0.1</code> or <code>localhost</code> as a SOCKS5 proxy, with port <code>9050</code> for plain Tor with standard settings.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> If multiple entries are present, Tor will perform stream isolation between listeners by default.</div>
<p>The proxy supports remote DNS resolution: use <code>socks5<b>h</b>://localhost:9050</code> for DNS resolution from the exit node (instead of <code>socks5</code> for a local DNS resolution).
</p>
<p>To check if Tor is functioning properly, visit <a rel="nofollow" class="external free" href="https://check.torproject.org/">https://check.torproject.org/</a> with Tor Browser or <a href="../en/CURL.html" class="mw-redirect" title="Curl">curl</a>:
</p>
<pre>$ curl -x socks5h://localhost:9050 -s <a rel="nofollow" class="external free" href="https://check.torproject.org">https://check.torproject.org</a>
</pre>
<h2><span class="mw-headline" id="Configuration">Configuration</span></h2>
<p>Tor reads its configurations from the file <code>/etc/tor/torrc</code> by default, or if the latter is not found, from <code>$HOME/.torrc</code>. The configuration options are explained in <span class="plainlinks archwiki-template-man" title="$ man 1 tor"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tor.1">tor(1)</a></span>.
</p>
<p>Drop-in files are supported by enabling:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tor/torrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">%include /etc/torrc.d/*.conf</pre>
<p>To reload the configuration after a change, <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Reload">reload</a> <code>tor.service</code>.
</p>
<h3><span class="mw-headline" id="Tor_ControlPort">Tor ControlPort</span></h3>
<p>Some programs may require access to your <i>Tor ControlPort</i> to gain low-level control over your Tor node.
</p>
<p>The <code>ControlPort</code> allows other programs to monitor and modify your Tor node's configuration while it is running, or get details about the status of the Tor network and its circuits.
</p>
<p>To enable it, add to your <code>torrc</code>:
</p>
<pre>ControlPort 9051
</pre>
<p>From <a rel="nofollow" class="external text" href="https://spec.torproject.org/control-spec/protocol-outline.html">The Tor Control Protocol</a>:
</p>
<dl><dd>For security, the stream (<i>T</i>or <i>C</i>ontrol) should not be accessible by untrusted parties.</dd></dl>
<p>To enhance security, restrict access to the <code>ControlPort</code> using a <i>cookie file</i>, <i>control password</i>, or both.
</p>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Only grant the password or cookie access to trusted processes and users, as they can be used to modify any configuration options of the service.</div>
<h4><span class="mw-headline" id="Nyx">Nyx</span></h4>
<p>Assuming the <code>ControlPort 9051</code> is set in <code>torrc</code>, you can start <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nyx">nyx</a></span> by running:
</p>
<pre>$ nyx
</pre>
<p>To watch Tor connections in nyx <a rel="nofollow" class="external autonumber" href="https://nyx.torproject.org/#no_connections">[1]</a>, add to your <code>torrc</code>:
</p>
<pre>DisableDebuggerAttachment 0
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> It is not recommended to run <code>nyx</code> unrestricted. Follow <a href="#Set_a_Tor_Control_cookie_file">#Set a Tor Control cookie file</a> and/or <a href="#Set_a_Tor_Control_password">#Set_a_Tor_Control_password</a>.</div>
<h4><span class="mw-headline" id="Set_a_Tor_Control_cookie_file">Set a Tor Control cookie file</span></h4>
<p>Add to your <code>torrc</code>:
</p>
<pre>CookieAuthentication 1
CookieAuthFile /var/lib/tor/control_auth_cookie
CookieAuthFileGroupReadable 1
DataDirectoryGroupReadable 1
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>tor.service</code> to apply the change.
</p>
<p>Enabling <code>CookieAuthentication</code> restricts access to the <code>ControlPort</code> by enforcing file permissions on the Tor cookie file and the Tor data directory.
</p>
<p>Add users to the <code>tor</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a> to give them access to the Tor cookie file.
</p>
<p>You can use this command to check the permissions:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ stat -c%a /var/lib/tor /var/lib/tor/control_auth_cookie</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">750
640</pre>
<h4><span class="mw-headline" id="Set_a_Tor_Control_password">Set a Tor Control password</span></h4>
<p>Convert your password from plaintext to hash:
</p>
<pre>$ set +o history # unset bash history
$ tor --hash-password <i>your_password</i>
$ set -o history # set bash history
</pre>
<p>Add the generated hash to your <code>torrc</code>:
</p>
<pre>HashedControlPassword <i>your_hash</i>
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The bash history commands prevent your cleartext password from being written to your bash <code>$HISTFILE</code>.</div>
<h4><span class="mw-headline" id="Open_Tor_ControlSocket">Open Tor ControlSocket</span></h4>
<p>If a program requires access to your Tor <code>ControlSocket</code>, such as a <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" class="extiw" title="wikipedia:Unix domain socket">Unix domain Socket</a>, add the following to your <code>torrc</code>:
</p>
<pre>ControlSocket /var/lib/tor/control_socket
ControlSocketsGroupWritable 1
DataDirectoryGroupReadable 1
</pre>
<p>Add the user who will run the program to the <code>tor</code> <a href="../en/Users_and_groups.html#Group_management" class="mw-redirect" title="User group">user group</a>.
</p>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">Restart</a> <code>tor.service</code> and relaunch the program.
</p>
<p>To verify the <code>ControlSocket</code> permissions:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ stat -c%a /var/lib/tor /var/lib/tor/control_socket</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">750
660</pre>
<h4><span class="mw-headline" id="Testing">Testing</span></h4>
<p>To test your <code>ControlPort</code>, run <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=gnu-netcat">gnu-netcat</a></span> with:
</p>
<pre>$ echo -e 'PROTOCOLINFO\r\n' | nc 127.0.0.1 9051
</pre>
<p>To test your <code>ControlSocket</code>, run <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=socat">socat</a></span> with:
</p>
<pre>$ echo -e 'PROTOCOLINFO\r\n' | socat - UNIX-CLIENT:/var/lib/tor/control_socket
</pre>
<p>Both commands should print:
</p>
<pre>250-PROTOCOLINFO 1
250-AUTH METHODS=COOKIE,SAFECOOKIE,HASHEDPASSWORD COOKIEFILE="/var/lib/tor/control_auth_cookie"
250-VERSION Tor="0.4.8.12"
250 OK
514 Authentication required.</pre>
<p>See <a rel="nofollow" class="external text" href="https://spec.torproject.org/control-spec/commands.html">The Tor Control Protocol</a> for more commands.
</p>
<h2><span class="mw-headline" id="Web_browsing">Web browsing</span></h2>
<p>The only way to browse anonymously is with the supported <i>Tor Browser</i>, which uses a patched version of <a href="../en/Firefox.html" title="Firefox">Firefox</a>. It can be installed with the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=torbrowser-launcher">torbrowser-launcher</a></span> package.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> While Tor can be used with regular browsers, it is not recommended. Even in "private browsing" mode, factors such as <a rel="nofollow" class="external text" href="https://support.torproject.org/glossary/browser-fingerprinting/">fingerprinting</a>, <a rel="nofollow" class="external text" href="https://support.torproject.org/glossary/#add-on-extension-or-plugin">plugins</a>, and DNS leaks may reveal your IP address or identity. <a rel="nofollow" class="external autonumber" href="https://support.torproject.org/#tbb_tbb-9">[2]</a>
</div>
<h2><span class="mw-headline" id="HTTP_proxy">HTTP proxy</span></h2>
<p>Tor offers a built-in tunneled HTTP proxy and can also be used with an HTTP proxy like <a href="../en/Privoxy.html" title="Privoxy">Privoxy</a>; however, using the SOCKS5 library is generally recommended.
</p>
<h3><span class="mw-headline" id="Tor">Tor</span></h3>
<p>Add following line to your <code>torrc</code> file to set port <code>8118</code> on your <code>localhost</code> as HTTP proxy:
</p>
<pre>HTTPTunnelPort 127.0.0.1:8118
</pre>
<p>Refer to <a rel="nofollow" class="external text" href="https://2019.www.torproject.org/docs/tor-manual.html.en#HTTPTunnelPort">Tor manual</a> for further information.
</p>
<h3><span class="mw-headline" id="Firefox">Firefox</span></h3>
<p>The <a rel="nofollow" class="external text" href="https://addons.mozilla.org/firefox/addon/foxyproxy-standard/">FoxyProxy</a> add-on  allows you to specify multiple proxies for different URLs or for all your browsing. After restarting Firefox manually set Firefox to port <code>8118</code> on <code>localhost</code>, which is where <a href="../en/Privoxy.html" title="Privoxy">Privoxy</a> are running. These settings can be access under <i>Add &gt; Standard proxy type</i>. Select a proxy label (e.g Tor) and enter the port and host into the <i>HTTP Proxy</i> and <i>SSL Proxy</i> fields. To check if Tor is functioning properly visit the <a rel="nofollow" class="external text" href="https://check.torproject.org/">Tor Check</a> website and toggle Tor.
</p>
<h3><span class="mw-headline" id="Privoxy">Privoxy</span></h3>
<p>You can also use this setup in other applications like messaging (e.g. <a href="../en/List_of_applications/Internet.html#XMPP_clients" class="mw-redirect" title="Jabber">Jabber</a>, <a href="../en/List_of_applications/Internet.html#IRC_clients" class="mw-redirect" title="IRC client">IRC clients</a>). Applications that support HTTP proxies you can connect to Privoxy (i.e. <code>127.0.0.1:8118</code>). To use SOCKS proxy directly, you can point your application at Tor (i.e. <code>127.0.0.1:9050</code>). A problem with this method though is that applications doing DNS resolves by themselves may leak information. Consider using Socks4A (e.g. with Privoxy) instead.
</p>
<h2><span class="mw-headline" id="Instant_messaging">Instant messaging</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-cut.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is being considered for removal.</b></p>
<div>
<b>Reason:</b> Instant messaging clients should document Tor usage on their respective pages, to avoid cluttering this page. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<p>In order to use an instant messaging client with tor, we do not need an HTTP proxy like <a href="../en/Privoxy.html" title="Privoxy">privoxy</a>. We will be using tor's daemon directly which listens to port 9050 by default.
</p>
<h3><span class="mw-headline" id="Pidgin">Pidgin</span></h3>
<p>You can set up <a href="../en/Pidgin.html" title="Pidgin">Pidgin</a> to use Tor globally, or per account. To use Tor globally, go to <i>Tools -&gt; Preferences -&gt; Proxy</i>. To use Tor for specific accounts, go to <i>Accounts &gt; Manage Accounts</i>, select the desired account, click Modify, then go to the Proxy tab. The proxy settings are as follows:
</p>
<pre>Proxy type: SOCKS 5
Host: 127.0.0.1
Port: 9050
</pre>
<h3><span class="mw-headline" id="Irssi">Irssi</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> <code>cap_sasl.pl</code> is broken with <i>perl</i> 5.20; SSL does also not work with <code>torsocks</code> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<p>Libera Chat recommends connecting to <code>.onion</code> directly. It also requires SASL to identify to NickServ during connection; see <a href="../en/Irssi.html#Authenticating_with_SASL" title="Irssi">Irssi#Authenticating with SASL</a>. Start irssi:
</p>
<pre>$ torsocks irssi
</pre>
<p>Set your identification to nickserv, which will be read when connecting. Supported mechanisms are ECDSA-NIST256P-CHALLENGE (see <a rel="nofollow" class="external text" href="https://github.com/kaniini/ecdsatool/blob/master/example-for-cap_sasl.pl">ecdsatool</a>) and PLAIN. DH-BLOWFISH <a rel="nofollow" class="external text" href="https://libera.chat/guides/sasl">is not supported</a>.
</p>
<pre>/sasl set <i>network</i> <i>username</i> <i>password</i> <i>mechanism</i>
</pre>
<p>Disable CTCP and DCC and set a different hostname to prevent information disclosure: <a rel="nofollow" class="external autonumber" href="https://web.archive.org/web/20160123165938/https://encrypteverything.ca/IRC_Anonymity_Guide">[3]</a>
</p>
<pre>/ignore * CTCPS
/ignore * DCC
/set hostname <i>fake_host</i>
</pre>
<p>Connect to Libera Chat:
</p>
<pre>/connect -network <i>network</i> libera75jm6of4wxpxt4aynol3xjmbtxgfyjpu34ss4d7r7q2v5zrpyd.onion
</pre>
<p>For more information check <a rel="nofollow" class="external text" href="https://libera.chat/guides/connect#accessing-liberachat-via-tor">Accessing Libera.Chat Via Tor</a>, <a rel="nofollow" class="external text" href="https://libera.chat/guides/sasl">Using SASL</a> or <a rel="nofollow" class="external text" href="https://trac.torproject.org/projects/tor/wiki/doc/TorifyHOWTO/IrcSilc">IRC/SILC Wiki article</a>.
</p>
<h2><span class="mw-headline" id="Pacman">Pacman</span></h2>
<p><a href="../en/Pacman.html" title="Pacman">Pacman</a> download operations (repository databases, packages, and public keys) can be done using the Tor network.
</p>
<p>Advantages:
</p>
<ul>
<li>Attackers monitoring your Internet connection and specifically targeting your machine can no longer observe its updates. This makes it difficult for them to deduce which packages you have installed, their versions, or your update frequency. However, they can still learn the software and versions you use by other means, such as watching packets from your HTTP server or probing the machine, which reveals the installed HTTP server and its version.</li>
<li>If a mirror is not an onion service, a malicious exit relay in your Tor circuit may watch your updates and decide to attack you, but it is unlikely to deanonymize you.</li>
<li>Attackers trying to prevent your machine from getting security fixes by making it believe there are no new updates will have a harder time, as they cannot target your machine specifically.</li>
</ul>
<p>Disadvantages:
</p>
<ul><li>Longer update times due to longer latency and lower throughput. This can pose a big security risk if updates need to be applied as quickly as possible, especially on machines directly connected to the Internet. That is the case when there is a major security flaw that is easy to probe and exploit, and attackers have already begun targeting as many systems as they can before those systems are updated.</li></ul>
<p>Reliability with Tor:
</p>
<ul>
<li>You no longer need a working DNS.</li>
<li>You depend on the Tor network and the exit nodes not blocking the updates.</li>
<li>You rely on the Tor daemon to work properly. The Tor daemon may not work if there is insufficient disk space available. "Reserved blocks gid:" in ext4, quotas, or other means can fix that.</li>
<li>If you are in a country where Tor is blocked, or if there are very few or no Tor users, you should use bridges.</li>
</ul>
<p>Note on GPG:
On stock Arch, pacman only trust keys which are either signed by you (that can be done with <code>pacman-key --lsign-key</code>) or signed by 3 of 5 Arch master keys. If a malicious exit node replaces packages with ones signed by its key, pacman will not let the user install the package.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  This might not be true for other distributions derived from Arch, for non-official repositories, and for AUR.</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pacman.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
XferCommand = /usr/bin/curl --socks5-hostname localhost:9050 --location --continue-at - --fail --output %o %u
...</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Due to work in progress for database signatures, you might get a 404 error for the signatures. Depending on your <a href="../en/Pacman/Package_signing.html#Configuring_pacman" title="Pacman/Package signing">Pacman/Package signing#Configuring pacman</a>, it should be harmless.</div>
<h2><span class="mw-headline" id="Running_a_Tor_relay">Running a Tor relay</span></h2>
<p>The Tor network is reliant on people contributing bandwidth and setting up services. There are several ways to contribute to the network.
</p>
<p>A usual Tor circuit consists of:
</p>
<pre>Tor User -&gt; Guard Relay -&gt; Middle Relay -&gt; Exit Relay -&gt; Destination (i.e. example.com)
</pre>
<p>See the <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/">official documentation</a> and <a rel="nofollow" class="external text" href="https://community.torproject.org/policies/relays/expectations-for-relay-operators/">Expectations for Relay Operators</a> for more information.
</p>
<h3>
<span id="Running_a_Middle.2FGuard_relay"></span><span class="mw-headline" id="Running_a_Middle/Guard_relay">Running a Middle/Guard relay</span>
</h3>
<p>Also known as non-exit relays: A guard relay is the first hop in a Tor circuit, while a middle relay acts as the second hop.
</p>
<p>This means that your machine will act as an entry node or forwarding relay and, unlike a <a href="#Running_a_Tor_bridge">bridge</a>, it will be listed in the public Tor directory. Your IP address will be publicly visible in the Tor directory but the relay will only forward to other relays or <a href="#Running_a_Tor_exit_relay">Tor exit nodes</a>, not directly to the internet.
</p>
<p>To <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/setup/">setup</a> a non-exit relay, see <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/guard/archlinux/">[4]</a> and <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/post-install/">[5]</a>.
</p>
<h3><span class="mw-headline" id="Running_a_Tor_bridge">Running a Tor bridge</span></h3>
<p>A Tor bridge is a Tor relay that is not listed in the public Tor directory, thus making it possible for people to connect to the Tor network when governments or ISPs block all public Tor relays. Visit <a rel="nofollow" class="external free" href="https://bridges.torproject.org/">https://bridges.torproject.org/</a> for more information and instructions on how to get bridge addresses.
</p>
<p>To <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/setup/bridge/">setup</a> a Tor bridge, see <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/bridge/archlinux/">[6]</a> and <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/post-install/">[7]</a>.
</p>
<h3><span class="mw-headline" id="Running_a_Tor_exit_relay">Running a Tor exit relay</span></h3>
<p>Any requests from a Tor user to the regular internet must exit the Tor network at some point, and exit relays provide this essential service. To the destination host, these requests will appear to originate from your machine. This means that running an exit relay is typically viewed as more legally burdensome than running other types of Tor relays.
</p>
<p>Before becoming an exit relay, it is <b>strongly</b> recommended to read <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/community-resources/">Legal resources</a> and <a rel="nofollow" class="external text" href="https://blog.torproject.org/tips-running-exit-node/">tips for running an exit node</a>.
</p>
<p>To setup an exit relay, see <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/exit/">[8]</a> and <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/post-install/">[9]</a>.
</p>
<h4><span class="mw-headline" id="Configuration_2">Configuration</span></h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-cut.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is being considered for removal.</b></p>
<div>
<b>Reason:</b> Content that is 10+ years old provides little value beyond the <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/">official documentation</a>, including possibly wrong iptables rules that could pose risks. Also, pdnsd has not been maintained since 2012. Tor Project recommends using up-to-date resources for firewall rules and unbound for DNS. <a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/post-install/">[10]</a><a rel="nofollow" class="external autonumber" href="https://community.torproject.org/relay/setup/exit/">[11]</a> (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<p>Using the <code>torrc</code>, you can configure which services you wish to allow through your exit relay.
</p>
<p>Make the relay an exit relay:
</p>
<pre>ExitRelay 1
</pre>
<p>Allow all traffic:
</p>
<pre>ExitPolicy accept *:*
</pre>
<p>Allow only IRC ports <code>6660-6667</code> but nothing else to exit from relay:
</p>
<pre>ExitPolicy accept *:6660-6667,reject *:*
</pre>
<p>By default, Tor will block certain ports. You can use the <code>torrc</code> to override this, for example accepting NNTP: 
</p>
<pre>ExitPolicy accept *:119
</pre>
<h4>
<span id=".2B100Mbps_Exit_Relay_configuration_example"></span><span class="mw-headline" id="+100Mbps_Exit_Relay_configuration_example">+100Mbps Exit Relay configuration example</span>
</h4>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:View-refresh-red.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is out of date.</b></p>
<div>
<b>Reason:</b> Should probably be switched from legacy <a href="../en/Iptables.html" title="Iptables">iptables</a> to <a href="../en/Nftables.html" title="Nftables">nftables</a>. Also, review what still counts as a "fast relay" in currentyear. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<p>If you run a fast exit relay (+100Mbps) with <code>ORPort 443</code> and <code>DirPort 80</code>, the following configuration changes might serve as inspiration to setup Tor alongside <a href="../en/Iptables.html" title="Iptables">iptables</a> firewall and <a href="../en/Pdnsd.html" title="Pdnsd">pdnsd</a> as DNS cache. It is important to <i>first</i> read <a rel="nofollow" class="external text" href="https://community.torproject.org/relay/setup/post-install/">Relay Post-install and good practices</a>. 
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> See <a href="#Running_Tor_in_a_systemd-nspawn_container_with_a_virtual_network_interface">#Running Tor in a systemd-nspawn container with a virtual network interface</a> for instructions to install Tor in a <code>systemd-nspawn</code> container.</div>
<h5><span class="mw-headline" id="Tor_2">Tor</span></h5>
<h6><span class="mw-headline" id="Raise_maximum_number_of_open_file_descriptors">Raise maximum number of open file descriptors</span></h6>
<p>To handle more than 32768 connections, <code>LimitNOFILE</code> can be raised <a rel="nofollow" class="external autonumber" href="https://support.torproject.org/#relay-operators_packaged-tor">[12]</a>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/increase-file-limits.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
LimitNOFILE=65536</pre>
<p>To successfully raise <code>nofile</code> limit, you may also have to append the following:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/security/limits.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
tor     soft    nofile    65536
tor     hard    nofile    65536
@tor    soft    nofile    65536
@tor    hard    nofile    65536
</pre>
<p>Check if the <code>nofile</code> (filedescriptor) limit is successfully raised with <code>ulimit -Hn</code> as the tor user.
</p>
<h6><span class="mw-headline" id="Start_tor.service_as_root_to_bind_Tor_to_privileged_ports">Start tor.service as root to bind Tor to privileged ports</span></h6>
<p>To bind Tor to privileged ports the service must be started as root. Please specify <code>User tor</code> option in <code>/etc/tor/torrc</code>.
</p>
<h6><span class="mw-headline" id="Tor_configuration">Tor configuration</span></h6>
<p>An example configuration:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tor/torrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">SOCKSPort 0                                       ## Pure relay configuration without local socks proxy

Log notice stdout                                 ## Default Tor behavior

ControlPort 9051                                  ## For nyx connection
CookieAuthentication 1                            ## For nyx connection

ORPort 443                                        ## Service must be started as root

Address $IP                                       ## IP or FQDN
Nickname $NICKNAME                                ## Nickname displayed in <a rel="nofollow" class="external text" href="https://metrics.torproject.org/rs.html">Tor Relay Search</a>

RelayBandwidthRate 500 Mbits                      ## bytes/KBytes/MBytes/GBytes/KBits/MBits/GBits
RelayBandwidthBurst 1000 MBits                    ## bytes/KBytes/MBytes/GBytes/KBits/MBits/GBits

ContactInfo $E-MAIL                               ## <a rel="nofollow" class="external text" href="https://gitlab.torproject.org/tpo/community/relays/-/issues/18">Tor Relay good practices</a> suggests an email

DirPort 80                                        ## Service must be started as root
DirPortFrontPage /etc/tor/tor-exit-notice.html    ## <a rel="nofollow" class="external text" href="https://gitlab.torproject.org/tpo/core/tor/-/raw/main/contrib/operator-tools/tor-exit-notice.html">Original</a>

MyFamily $($KEYID),$($KEYID)...                   ## Remember $ in front of keyid(s) ;)

ExitPolicy reject XXX.XXX.XXX.XXX/XX:*            ## Block domain of public IP in addition to std. exit policy

User tor                                          ## Return to tor user after service started as root

DisableDebuggerAttachment 0                       ## For nyx connection

### Performance related options ###
AvoidDiskWrites 1                                 ## Reduce wear on SSD
DisableAllSwap 1                                  ## Service must be started as root
HardwareAccel 1                                   ## Look for OpenSSL hardware cryptographic support
NumCPUs 2                                         ## Only start two threads</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 1 tor"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/tor.1">tor(1)</a></span> for details.
</p>
<p>Tor opens a socks proxy on port 9050 by default — even if you do not configure one. Set <code>SOCKSPort 0</code> if you plan to run Tor only as a relay, and not make any local application connections yourself.
</p>
<p><code>Log notice stdout</code> changes logging to stdout, which is also the Tor default.
</p>
<p><code>ControlPort 9051</code>, <code>CookieAuthentication 1</code> and <code>DisableDebuggerAttachment 0</code> enables <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nyx">nyx</a></span> to connect to Tor and display connections.
</p>
<p><code>ORPort 443</code> and <code>DirPort 80</code> lets Tor listen on port 443 and 80.
</p>
<p><code>DirPortFrontPage</code> displays <a rel="nofollow" class="external text" href="https://gitlab.torproject.org/tpo/core/tor/-/raw/main/contrib/operator-tools/tor-exit-notice.html">tor-exit-notice.html</a> on port 80.
</p>
<p><code>ExitPolicy reject XXX.XXX.XXX.XXX/XX:*</code> should reflect your public IP and netmask, which can be obtained with the command <code>ip addr</code>, so exit connections cannot connect to the host or neighboring machines public IP and circumvent firewalls.
</p>
<p><code>AvoidDiskWrites 1</code> reduces disk writes and wear on SSD.
</p>
<p><code>DisableAllSwap 1</code> "will attempt to lock all current and future memory pages, so that memory cannot be paged out". 
</p>
<p>If <code>grep aes /proc/cpuinfo</code> returns that your CPU supports AES instructions and <code>lsmod | grep aes</code> returns that the module is loaded, you can specify <code>HardwareAccel 1</code> which tries "to use built-in (static) crypto hardware acceleration when available", see <a rel="nofollow" class="external free" href="https://www.torservers.net/wiki/setup/server#aes-ni_crypto_acceleration">https://www.torservers.net/wiki/setup/server#aes-ni_crypto_acceleration</a>.
</p>
<p><code>ORPort 443</code>, <code>DirPort 80</code> and <code>DisableAllSwap 1</code> require that you start the Tor service as <code>root</code> as described in <a href="#Start_tor.service_as_root_to_bind_Tor_to_privileged_ports">#Start tor.service as root to bind Tor to privileged ports</a>.
</p>
<p>Use the <code>User tor</code> option to properly reduce Tor’s privileges.
</p>
<h5><span class="mw-headline" id="iptables">iptables</span></h5>
<p>Setup and learn to use <a href="../en/Iptables.html" title="Iptables">iptables</a>. Instead of being a <a href="../en/Simple_stateful_firewall.html" title="Simple stateful firewall">Simple stateful firewall</a> where connection tracking would have to track thousands of connections on a tor exit relay this firewall configuration is stateless.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/iptables/iptables.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">*raw
-A PREROUTING -j NOTRACK
-A OUTPUT -j NOTRACK
COMMIT

*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p tcp ! --syn -j ACCEPT
-A INPUT -p udp -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -i lo -j ACCEPT
COMMIT</pre>
<p><code>-A PREROUTING -j NOTRACK</code> and <code>-A OUTPUT -j NOTRACK</code> disables connection tracking in the <code>raw</code> table.
</p>
<p><code>:INPUT DROP [0:0]</code> is the default <code>INPUT</code> target and drops input traffic we do not specifically <code>ACCEPT</code>.
</p>
<p><code>:FORWARD DROP [0:0]</code> is the default <code>FORWARD</code> target and only relevant if the host is a normal router, not  when the host is an onion router.
</p>
<p><code>:OUTPUT ACCEPT [0:0]</code> is the default <code>OUTPUT</code> target and allows all outgoing connections.
</p>
<p><code>-A INPUT -p tcp ! --syn -j ACCEPT</code> allow already established incoming TCP connections per the rules below and TCP connections established from the exit node.
</p>
<p><code>-A INPUT -p udp -j ACCEPT</code> allow all incoming UDP connections because we do not use connection tracking.
</p>
<p><code>-A INPUT -p icmp -j ACCEPT</code> allow <a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol" class="extiw" title="wikipedia:Internet Control Message Protocol">ICMP</a>.
</p>
<p><code>-A INPUT -p tcp --dport 443 -j ACCEPT</code> allow incoming connections to the <code>ORPort</code>.
</p>
<p><code>-A INPUT -p tcp --dport 80 -j ACCEPT</code> allow incoming connections to the <code>DirPort</code>.
</p>
<p><code>-A INPUT -i lo -j ACCEPT</code> allows all connections on the loopback interface.
</p>
<h5><span class="mw-headline" id="pdnsd">pdnsd</span></h5>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> This configuration assumes your network DNS resolver is trusted (uncensored).</div>
<p>You can use <a href="../en/Pdnsd.html" title="Pdnsd">pdnsd</a> to cache DNS queries locally, so the exit relay can resolve DNS faster and the exit relay does not forward all DNS queries to an external DNS recursor.
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/pdnsd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">...
perm_cache=102400                       ## (Default value)*100 = 1MB * 100 = 100MB
...
server {
    label= "resolvconf";
    file = "/etc/pdnsd-resolv.conf";    ## Preferably do not use /etc/resolv.conf
    timeout=4;                          ## Server timeout, this may be much shorter than the global timeout option.
    uptest=query;                       ## Test availability using empty DNS queries. 
    query_test_name=".";                ## To be used if remote servers ignore empty queries.
    interval=10m;                       ## Test every 10 minutes.
    purge_cache=off;                    ## Ignore TTL.
    edns_query=yes;                     ## Use EDNS for outgoing queries to allow UDP messages larger than 512 bytes. May cause trouble with some legacy systems.
    preset=off;                         ## Assume server is down before uptest.
 }
...</pre>
<p>This configuration stub shows how to cache queries to your normal DNS recursor locally and increase pdnsd cache size to 100MB.
</p>
<h6><span class="mw-headline" id="Uncensored_DNS">Uncensored DNS</span></h6>
<p>If your local DNS recursor is in some way censored or interferes with DNS queries, see <a href="../en/Domain_name_resolution.html#Third-party_DNS_services" class="mw-redirect" title="Alternative DNS services">Alternative DNS services</a> for alternatives and add them in a separate server-section in <code>/etc/pdnsd.conf</code> as per <a href="../en/Pdnsd.html#DNS_servers" title="Pdnsd">Pdnsd#DNS servers</a>.
</p>
<h5><span class="mw-headline" id="Ensuring_relay_is_working">Ensuring relay is working</span></h5>
<p>To verify the function of your tor relay,
check that <code>tor.service</code> started correctly with the <a href="../en/Systemd/Journal.html" class="mw-redirect" title="Journal">journal</a> or the <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Unit status">unit status</a>. 
If there are no errors, run <code>nyx</code> to ensure your relay is making connections. 
Do not be concerned if your <a rel="nofollow" class="external text" href="https://blog.torproject.org/lifecycle-new-relay">new relay</a> is slow at first; this is normal. 
After approximately 3 hours, your relay should be published and searchable on <a rel="nofollow" class="external text" href="https://metrics.torproject.org/rs.html#search">Relay Search</a>.
</p>
<h2><span class="mw-headline" id="Tor_DNS">Tor DNS</span></h2>
<p>DNS queries can be performed through the command-line interface by using <code>tor-resolve</code>. For example:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">$ tor-resolve archlinux.org</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">66.211.214.131
</pre>
<p>The tor 0.2.x series also provides a built-in DNS forwarder. To enable it, add the following lines to the Tor configuration file and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Restart">restart</a> the daemon:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/tor/torrc</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">DNSPort 9053
AutomapHostsOnResolve 1
AutomapHostsSuffixes .exit,.onion
</pre>
<p>This will allow tor to accept DNS requests (listening on port <code>9053</code>) like a regular DNS server, and resolve the domain via the Tor network.
</p>
<p>A downside of both methods is that they are only able to resolve DNS queries for A, AAAA and PTR records; MX and NS queries are never answered. For more information see this <a rel="nofollow" class="external text" href="https://techstdout.boum.org/TorDns/">Debian-based introduction</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> See <a rel="nofollow" class="external autonumber" href="https://support.torproject.org/#misc_check-socks-dns-leaks">[13]</a> to check if an application is leaking DNS requests.</div>
<h3><span class="mw-headline" id="Using_Tor_DNS_systemwide">Using Tor DNS systemwide</span></h3>
<p>It is possible to configure your system to use Tor DNS for any A, AAAA, and PTR queries your system makes, regardless of whether you eventually use Tor to connect to your final destination. To do this, configure your system to use <code>127.0.0.1</code> as its DNS server and edit the <code>DNSPort</code> line in <code>/etc/tor/torrc</code> to show:
</p>
<pre>DNSPort 53
</pre>
<p>Alternatively, you can use a local caching DNS server, such as <a href="../en/Dnsmasq.html" title="Dnsmasq">dnsmasq</a> or <a href="../en/Pdnsd.html" title="Pdnsd">pdnsd</a>, which will also compensate for Tor DNS being a little slower than traditional DNS servers. The following instructions will show how to set up <i>dnsmasq</i> for this purpose. Note, if you are using <i>NetworkManager</i> you will need to add your configuration file to the location outlined in <a href="../en/NetworkManager.html#dnsmasq" title="NetworkManager">NetworkManager#dnsmasq</a>.
</p>
<p>Change the tor setting to listen for the DNS request in port <code>9053</code> and install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=dnsmasq">dnsmasq</a></span>.
</p>
<p>Modify its configuration file so that it contains:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dnsmasq.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">no-resolv
port=53
server=127.0.0.1#9053
listen-address=127.0.0.1</pre>
<p>These configurations set dnsmasq to listen only for requests from the local computer, and to use Tor DNS at its sole upstream provider. It is now necessary to edit <code>/etc/resolv.conf</code> so that your system will query only the dnsmasq server:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/resolv.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nameserver 127.0.0.1
</pre>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> the <code>dnsmasq.service</code>.
</p>
<p>Finally, if you use <a href="../en/Dhcpcd.html" title="Dhcpcd">dhcpcd</a> you need to change its settings so that it does not alter the <code>resolv.conf</code> file. Add this line in the configuration file:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/dhcpcd.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">nohook resolv.conf
</pre>
<p>If you already have an <code>nohook</code> line, add <code>resolv.conf</code> separated by a comma.
</p>
<h2><span class="mw-headline" id="Torsocks">Torsocks</span></h2>
<p><span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=torsocks">torsocks</a></span> allows you to use an application through the Tor network without requiring any configuration changes to the application itself. From <span class="plainlinks archwiki-template-man" title="$ man 1 torsocks"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/torsocks.1">torsocks(1)</a></span>:
</p>
<dl><dd>
<b>torsocks</b> is a wrapper between the torsocks library and the application in order to make every Internet communication go through the Tor network.</dd></dl>
<p>For a comparison of <code>torsocks</code> with its predecessor, see <a rel="nofollow" class="external autonumber" href="https://tor.stackexchange.com/a/21000">[14]</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> The wrapper deliberately and verbosely fails for certain system calls, which cause some applications to not fully work with it. See <a rel="nofollow" class="external text" href="https://stackoverflow.com/questions/46634215/torsocks-and-unsupported-syscalls">torsocks-and-unsupported-syscalls</a>.</div>
<p>Usage example:
</p>
<pre>$ torsocks elinks checkip.dyndns.org
$ torsocks wget -qO- <a rel="nofollow" class="external free" href="https://check.torproject.org/">https://check.torproject.org/</a> | grep -i congratulations
</pre>
<h2><span class="mw-headline" id="Transparent_Torification">Transparent Torification</span></h2>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Inaccurate.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>The factual accuracy of this article or section is disputed.</b></p>
<div>
<b>Reason:</b> How well those iptables rules protect against leaks, and why not just use <a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/About">Whonix</a><a rel="nofollow" class="external autonumber" href="https://www.whonix.org/wiki/Leaks">[15]</a>? It may be unwise to apply them blindly in your system. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<p>In some cases it is more secure and often easier to transparently torify an entire system instead of configuring individual applications to use Tor's socks port, not to mention preventing DNS leaks. Transparent torification can be done with <a href="../en/Iptables.html" title="Iptables">iptables</a> in such a way that all outbound packets are redirected through Tor's <i>TransPort</i>, except the Tor traffic itself. Once in place, applications do not need to be configured to use Tor, though Tor's <i>SOCKSPort</i> will still work. This also works for DNS via Tor's <i>DNSPort</i>, but realize that Tor only supports TCP, thus UDP packets other than DNS cannot be sent through Tor and therefore must be blocked entirely to prevent leaks.
</p>
<p>Using iptables to transparently torify a system affords comparatively strong leak protection, but it is not a substitute for virtualized torification applications such as Whonix, or TorVM <a rel="nofollow" class="external autonumber" href="https://www.whonix.org/wiki/Comparison_with_Others">[16]</a>. Transparent torification also will not protect against fingerprinting attacks on its own, so it is recommended to use an amnesic solution like <a rel="nofollow" class="external text" href="https://tails.net/">Tails</a> instead. Applications can still learn your computer's hostname, MAC address, serial number, timezone, etc. and those with root privileges can disable the firewall entirely. In other words, transparent torification with iptables protects against accidental connections and DNS leaks by misconfigured software, it is not sufficient to protect against malware or software with serious security vulnerabilities.
</p>
<p>When a transparent proxy is used, it is possible to start a Tor session from the client as well as from the transparent proxy, creating a "Tor over Tor" scenario.
Doing so produces undefined and potentially unsafe behavior. In theory, the user could get six hops instead of three in the Tor network. However, it is not guaranteed that the three additional hops received are different; the user could end up with the same hops, possibly in reverse or mixed order. 
The Tor Project opinion is that this is unsafe <a rel="nofollow" class="external autonumber" href="https://support.torproject.org/misc/#misc_misc-11">[17]</a>
<a rel="nofollow" class="external autonumber" href="https://gitlab.torproject.org/legacy/trac/-/wikis/doc/TorifyHOWTO#tor-over-tor">[18]</a>.
</p>
<p>To enable transparent torification, use the following file for <code>iptables-restore</code> and <code>ip6tables-restore</code> (internally used by <a href="../en/Systemd.html" title="Systemd">systemd</a>'s <code>iptables.service</code> and <code>ip6tables.service</code>).
</p>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> This file uses the NAT table to force outgoing connections through the TransPort or DNSPort, and blocks anything it cannot torrify.
<ul>
<li>Now using <code>--ipv6</code> and <code>--ipv4</code> for protocol specific changes. <code>iptables-restore</code> and <code>ip6tables-restore</code> can now use the same file.</li>
<li>Where <code>--ipv6</code> or <code>--ipv4</code> is explicitly defined, <code>ip*tables-restore</code> will ignore the rule if it is not for the correct protocol.</li>
<li>
<code>ip6tables</code> does not support <code>--reject-with</code>.</li>
</ul>
<p>Make sure your <code>torrc</code> contains the following lines:
</p>
<pre>SOCKSPort 9050
DNSPort 5353
TransPort 9040
</pre>
<p>See <span class="plainlinks archwiki-template-man" title="$ man 8 iptables"><a rel="nofollow" class="external text" href="https://man.archlinux.org/man/iptables.8">iptables(8)</a></span>.
</p>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> If you get this error: <code>iptables-restore: unable to initialize table 'nat'</code>, you have to load the appropriate kernel modules:
<pre># modprobe ip_tables iptable_nat ip_conntrack iptable-filter ipt_state
</pre>
</div>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/iptables/iptables.rules</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">*nat
:PREROUTING ACCEPT [6:2126]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [17:6239]
:POSTROUTING ACCEPT [6:408]

-A PREROUTING ! -i lo -p udp -m udp --dport 53 -j REDIRECT --to-ports 5353
-A PREROUTING ! -i lo -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j REDIRECT --to-ports 9040
-A OUTPUT -o lo -j RETURN
--ipv4 -A OUTPUT -d 192.168.0.0/16 -j RETURN
-A OUTPUT -m owner --uid-owner "tor" -j RETURN
-A OUTPUT -p udp -m udp --dport 53 -j REDIRECT --to-ports 5353
-A OUTPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j REDIRECT --to-ports 9040
COMMIT

*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]

-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
--ipv4 -A INPUT -p tcp -j REJECT --reject-with tcp-reset
--ipv4 -A INPUT -p udp -j REJECT --reject-with icmp-port-unreachable
--ipv4 -A INPUT -j REJECT --reject-with icmp-proto-unreachable
--ipv6 -A INPUT -j REJECT
--ipv4 -A OUTPUT -d 127.0.0.0/8 -j ACCEPT
--ipv4 -A OUTPUT -d 192.168.0.0/16 -j ACCEPT
--ipv6 -A OUTPUT -d ::1/8 -j ACCEPT
-A OUTPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -m owner --uid-owner "tor" -j ACCEPT
--ipv4 -A OUTPUT -j REJECT --reject-with icmp-port-unreachable
--ipv6 -A OUTPUT -j REJECT
COMMIT
</pre>
<p>This file also works for <code>ip6tables-restore</code>, so you may symlink it:
</p>
<pre># ln -s /etc/iptables/iptables.rules /etc/iptables/ip6tables.rules
</pre>
<p>Then make sure Tor is running, and <a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">start/enable</a> the <code>iptables</code> and <code>ip6tables</code> systemd units.
</p>
<p>You may want to add <code>Requires=iptables.service</code> and <code>Requires=ip6tables.service</code> to whatever systemd unit logs your user in (most likely a <a href="../en/Display_manager.html" title="Display manager">display manager</a>), to prevent any user processes from being started before the firewall up. See <a href="../en/Systemd.html" title="Systemd">systemd</a>.
</p>
<h2><span class="mw-headline" id="Tips_and_tricks">Tips and tricks</span></h2>
<h3><span class="mw-headline" id="Kernel_capabilities">Kernel capabilities</span></h3>
<p>To run tor as a non-root user and use a port lower than <code>1024</code>, you can use kernel capabilities to allow it to bind to privileged ports:
</p>
<pre># setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/tor
</pre>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong> Any upgrade to the tor package will reset the permissions. Consider using <a href="../en/Pacman.html#Hooks" title="Pacman">pacman#Hooks</a> to automatically set the permissions after upgrades.</div>
<p>If you use <code>tor.service</code>, it is also possible to use <a href="../en/Systemd.html" title="Systemd">systemd</a> to grant tor the appropriate permissions. This has the benefit that permissions do not need to be reapplied after every tor upgrade:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/netcap.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
CapabilityBoundingSet=
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
AmbientCapabilities=
AmbientCapabilities=CAP_NET_BIND_SERVICE</pre>
<p>Refer to <a rel="nofollow" class="external text" href="https://superuser.com/questions/710253/allow-non-root-process-to-bind-to-port-80-and-443">superuser.com</a> for further explanations.
</p>
<h3><span class="mw-headline" id="Using_system_tor_in_Tor_Browser">Using system tor in Tor Browser</span></h3>
<p>When using the Tor Browser, it is possible to use the running <code>tor.service</code> instead of establishing a second connection to the Tor network.
Instructions are provided in the starter file for the browser, which by default is located at <code> ~/.local/share/torbrowser/tbb/x86_64/tor-browser/Browser/start-tor-browser</code>.
</p>
<p>As of version <code>0.3.7</code>, you can follow these steps:
</p>
<ol>
<li>In <code>/etc/tor/torrc</code>, look for the option <code>#SOCKSPort</code> and copy down the address and port there. If no address is given, it is <code>127.0.0.1</code> by default, and if not port is given it is <code>9050</code> by default.</li>
<li>Follow the steps in <a href="#Tor_ControlPort">#Tor_ControlPort</a> and <a href="#Set_a_Tor_Control_password">#Set a Tor Control password</a>, and copy down both the password and control port you have set.</li>
<li>In the Tor Browser, navigate to <code>about:config</code> and set the following preferences: <pre># SETTING NAME                             VALUE
# network.proxy.socks                      &lt;SocksAddress&gt;
# network.proxy.socks_port                 &lt;SocksPort&gt;
# extensions.torbutton.inserted_button     true
# extensions.torbutton.launch_warning      false
# extensions.torbutton.loglevel            2
# extensions.torbutton.logmethod           0
# extensions.torlauncher.control_port      &lt;ControlPort&gt;
# extensions.torlauncher.loglevel          2
# extensions.torlauncher.logmethod         0
# extensions.torlauncher.prompt_at_startup false
# extensions.torlauncher.start_tor         false
</pre>
</li>
<li>Edit the start file of the Tor Browser, which by default is <code>~/.local/share/torbrowser/tbb/x86_64/tor-browser/Browser/start-tor-browser</code>. Replace <code><i>secret</i></code> with the control password in the following line: <pre>setControlPortPasswd ${TOR_CONTROL_PASSWD:='"<i>secret</i>"'}</pre>
<div class="archwiki-template-box archwiki-template-box-warning">
<strong>Warning:</strong> Do not modify the set of two quotes around <code><i>secret</i></code>.</div>
</li>
<li>Restart the Tor Browser. If successful, there should be a message on the startup page explaining that the connection is not managed by the Tor Browser, and <code>tor.service</code> should log a line saying <code>New control connection opened from &lt;SocksAddress&gt;</code>.</li>
</ol>
<h3><span class="mw-headline" id="Running_Tor_in_a_chroot">Running Tor in a chroot</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-edit-cut.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section is being considered for removal.</b></p>
<div>
<b>Reason:</b> chroot is not a security feature <a rel="nofollow" class="external autonumber" href="https://www.redhat.com/en/blog/chroot-security-feature">[19]</a>. <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tor">tor</a></span> ships with several systemd sandboxing options which conflicts with a chroot environment <a rel="nofollow" class="external autonumber" href="https://bbs.archlinux.org/viewtopic.php?id=259710">[20]</a>. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<div class="archwiki-template-box archwiki-template-box-note">
<strong>Note:</strong>  Connecting with telnet to the local ControlPort seems to be broken while running Tor in a chroot</div>
<p>For security purposes, it may be desirable to run Tor in a <a href="../en/Chroot.html" title="Chroot">chroot</a>. The following script will create an appropriate chroot in <code>/opt/torchroot</code>:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">~/torchroot-setup.sh</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">#!/bin/sh
export TORCHROOT=/opt/torchroot

mkdir -p $TORCHROOT
mkdir -p $TORCHROOT/etc/tor
mkdir -p $TORCHROOT/dev
mkdir -p $TORCHROOT/usr/bin
mkdir -p $TORCHROOT/usr/lib
mkdir -p $TORCHROOT/usr/share/tor
mkdir -p $TORCHROOT/var/lib
mkdir -p $TORCHROOT/var/log/tor/

ln -s /usr/lib  $TORCHROOT/lib
cp /etc/hosts           $TORCHROOT/etc/
cp /etc/host.conf       $TORCHROOT/etc/
cp /etc/localtime       $TORCHROOT/etc/
cp /etc/nsswitch.conf   $TORCHROOT/etc/
cp /etc/resolv.conf     $TORCHROOT/etc/

cp /usr/bin/tor         $TORCHROOT/usr/bin/
cp /usr/share/tor/geoip* $TORCHROOT/usr/share/tor/
cp /lib/libnss* /lib/libnsl* /lib/ld-linux-*.so* /lib/libresolv* /lib/libgcc_s.so* $TORCHROOT/usr/lib/
cp $(ldd /usr/bin/tor | awk '{print $3}'|grep --color=never "^/") $TORCHROOT/usr/lib/

### /var/log/tor/notices.log is only needed if you run hidden services
# cp /var/log/tor/notices.log $TORCHROOT/var/log/tor/

cp -r /var/lib/tor      $TORCHROOT/var/lib/
cp /etc/tor/torrc       $TORCHROOT/etc/tor/

chown tor:tor $TORCHROOT
chmod 700 $TORCHROOT
chown -R tor:tor $TORCHROOT/var/lib/tor
chown -R tor:tor $TORCHROOT/var/log/tor

sh -c "grep --color=never ^tor /etc/passwd &gt; $TORCHROOT/etc/passwd"
sh -c "grep --color=never ^tor /etc/group &gt; $TORCHROOT/etc/group"

mknod -m 644 $TORCHROOT/dev/random c 1 8
mknod -m 644 $TORCHROOT/dev/urandom c 1 9
mknod -m 666 $TORCHROOT/dev/null c 1 3

if [ "$(uname -m)" = "x86_64" ]; then
  cp /usr/lib/ld-linux-x86-64.so* $TORCHROOT/usr/lib/.
  ln -sr /usr/lib64 $TORCHROOT/lib64
  ln -s $TORCHROOT/usr/lib ${TORCHROOT}/usr/lib64
fi

</pre>
<p>After running the script as root, Tor can be launched in the <a href="../en/Chroot.html" title="Chroot">chroot</a> with the command:
</p>
<pre># chroot --userspec=tor:tor /opt/torchroot /usr/bin/tor
</pre>
<p>or, if you use systemd, <a href="../en/Systemd.html#Editing_provided_units" title="Systemd">overload</a> the service:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/system/tor.service.d/chroot.conf</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Service]
User=root
ExecStart=
ExecStart=/usr/bin/sh -c "chroot --userspec=tor:tor /opt/torchroot /usr/bin/tor -f /etc/tor/torrc"
KillSignal=SIGINT</pre>
<h3><span class="mw-headline" id="Running_Tor_in_a_systemd-nspawn_container_with_a_virtual_network_interface">Running Tor in a systemd-nspawn container with a virtual network interface</span></h3>
<div class="noprint archwiki-template-message">
<p><span class="mw-default-size" typeof="mw:File"><span><img src="../File:Tango-view-fullscreen.svg" decoding="async" width="48" height="48" class="mw-file-element"></span></span><b>This article or section needs expansion.</b></p>
<div>
<b>Reason:</b> It is not clear what this example is trying to achieve. (Discuss in <a rel="nofollow" class="external text" href="../en/Talk:Tor.html">Talk:Tor</a>)</div>
</div>
<p>In this example we will create a <a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a> container named <code>tor-exit</code> with a virtual macvlan network interface.
</p>
<p>See <a href="../en/Systemd-nspawn.html" title="Systemd-nspawn">systemd-nspawn</a> and <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> for full documentation.
</p>
<h4><span class="mw-headline" id="Host_installation_and_configuration">Host installation and configuration</span></h4>
<p>In this example the container will reside in <code>/srv/container</code>:
</p>
<pre># mkdir -p /srv/container/tor-exit
</pre>
<p><a href="../en/Help:Reading.html#Installation_of_packages" class="mw-redirect" title="Install">Install</a> the <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=arch-install-scripts">arch-install-scripts</a></span>.
</p>
<p>Install <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=base">base</a></span>, <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=tor">tor</a></span> and <span class="plainlinks archwiki-template-pkg"><a rel="nofollow" class="external text" href="https://archlinux.org/packages/?name=nyx">nyx</a></span> as per <a href="../en/Systemd-nspawn.html#Create_and_boot_a_minimal_Arch_Linux_container" title="Systemd-nspawn">systemd-nspawn#Create and boot a minimal Arch Linux container</a>:
</p>
<pre># pacstrap -K -ci /srv/container/tor-exit base tor nyx
</pre>
<p>Symlink to register the container on the host, as per <a href="../en/Systemd-nspawn.html#Management" title="Systemd-nspawn">systemd-nspawn#Management</a>:
</p>
<pre># ln -s /srv/container/tor-exit/ /var/lib/machines/
</pre>
<h4><span class="mw-headline" id="Virtual_network_interface">Virtual network interface</span></h4>
<p>Create a drop-in configuration file for the container:
</p>
<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:0.8em;">/etc/systemd/nspawn/tor-exit.nspawn</pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top: 0.8em;">[Network]
MACVLAN=<i>interface</i>

[Exec]
LimitNOFILE=65536</pre>
<p><code>MACVLAN=<i>interface</i></code> creates a "macvlan" interface named <code>mv-<i>interface</i></code> and assigns it to the container, see <a href='../en/Systemd-nspawn.html#Use_a_"macvlan"_or_"ipvlan"_interface' title="Systemd-nspawn">systemd-nspawn#Use a "macvlan" or "ipvlan" interface</a> for details. This is advisable for security as it will allow you to give a private IP to the container, and it will not know what your machine's IP is. This can help obscure DNS requests.
</p>
<p><code>LimitNOFILE=65536</code> per <a href="#Raise_maximum_number_of_open_file_descriptors">#Raise maximum number of open file descriptors</a>.
</p>
<p>Set up <a href="../en/Systemd-networkd.html" title="Systemd-networkd">systemd-networkd</a> according to your network in <code>/srv/container/tor-exit/etc/systemd/network/mv-<i>interface</i>.network</code>.
</p>
<h4><span class="mw-headline" id="Start_and_enable_systemd-nspawn">Start and enable systemd-nspawn</span></h4>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start/enable">Start/enable</a> <code>systemd-nspawn@tor-exit.service</code>.
</p>
<h4><span class="mw-headline" id="Container_configuration">Container configuration</span></h4>
<p>Login to the container (see <a href="../en/Systemd-nspawn.html#machinectl" title="Systemd-nspawn">systemd-nspawn#machinectl</a>):
</p>
<pre># machinectl shell root@tor-exit
</pre>
<h4><span class="mw-headline" id="Start_and_enable_systemd-networkd">Start and enable systemd-networkd</span></h4>
<p><a href="../en/Help:Reading.html#Control_of_systemd_units" class="mw-redirect" title="Start">Start</a> and enable <code>systemd-networkd.service</code>. <code>networkctl</code> displays if <code>systemd-networkd</code> is correctly configured.
</p>
<h4><span class="mw-headline" id="Configure_Tor">Configure Tor</span></h4>
<p>See <a href="#Running_a_Tor_relay">#Running a Tor relay</a>.
</p>
<div class="archwiki-template-box archwiki-template-box-tip">
<strong>Tip:</strong> It is easier to edit files in the container from the host with your normal editor.</div>
<h3><span class="mw-headline" id="Java">Java</span></h3>
<p>One can ensure a <a rel="nofollow" class="external text" href="https://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html">java application proxies</a> its connections through Tor by defining its <a href="../en/Environment_variables.html#Defining_variables" title="Environment variables">environment variable</a>:
</p>
<pre>JAVA_OPTIONS="$JAVA_OPTIONS -DsocksProxyHost=localhost -DsocksProxyPort=9050"
</pre>
<h2><span class="mw-headline" id="Troubleshooting">Troubleshooting</span></h2>
<h3><span class="mw-headline" id="Tor_Browser_proxy_problems">Tor Browser proxy problems</span></h3>
<p>Tor Browser typically works without significant customization. If the bundled proxy fails with <code>proxy server is refusing connections</code> for any website, consider reinstallation by removing the <code>~/.local/share/torbrowser/</code> directory (make sure to back up important files).
</p>
<h2><span class="mw-headline" id="See_also">See also</span></h2>
<ul>
<li><a rel="nofollow" class="external text" href="https://2019.www.torproject.org/about/torusers.html.en">Who uses Tor?</a></li>
<li><a rel="nofollow" class="external text" href="https://support.torproject.org/abuse/">Tor Abuse FAQ</a></li>
<li><a rel="nofollow" class="external text" href="https://tb-manual.torproject.org/circumvention/">Using pluggable transports to circumvent censorship</a></li>
<li><a rel="nofollow" class="external text" href="https://community.torproject.org/onion-services/setup/">Set up Your Onion Service</a></li>
<li><a rel="nofollow" class="external text" href="https://metrics.torproject.org/">Tor Metrics</a></li>
<li><a rel="nofollow" class="external text" href="https://gitlab.torproject.org/legacy/trac">Tor's archived wiki</a></li>
<li><a rel="nofollow" class="external text" href="https://www.whonix.org/wiki/Tor_Myths_and_Misconceptions">Whonix — Tor Myths and Misconceptions</a></li>
</ul>
</div>
</div>
					<div id="catlinks" class="catlinks" data-mw="interface">
<div id="mw-normal-catlinks" class="mw-normal-catlinks">
<a href="../Special:Categories.html" title="Special:Categories">Category</a>: <ul><li><a href="../en/Category:Anonymity_networks.html" title="Category:Anonymity networks">Anonymity networks</a></li></ul>
</div>
<div id="mw-hidden-catlinks" class="mw-hidden-catlinks mw-hidden-cats-hidden">Hidden categories: <ul>
<li><a href="../en/Category:Sections_flagged_with_Template:Remove.html" title="Category:Sections flagged with Template:Remove">Sections flagged with Template:Remove</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Out_of_date.html" title="Category:Pages or sections flagged with Template:Out of date">Pages or sections flagged with Template:Out of date</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Accuracy.html" title="Category:Pages or sections flagged with Template:Accuracy">Pages or sections flagged with Template:Accuracy</a></li>
<li><a href="../en/Category:Pages_or_sections_flagged_with_Template:Expansion.html" title="Category:Pages or sections flagged with Template:Expansion">Pages or sections flagged with Template:Expansion</a></li>
</ul>
</div>
</div>
				</div>
			</main>
			
		</div>
		<div class="mw-footer-container">
			
<footer id="footer" class="mw-footer" style="margin: 0">
	<ul id="footer-info">
	<li data-nosnippet="">Retrieved from "<a dir="ltr" href="https://wiki.archlinux.org/index.php?title=Tor&amp;oldid=841994">https://wiki.archlinux.org/index.php?title=Tor&amp;oldid=841994</a>"</li>
<li id="footer-info-lastmod"> This page was last edited on 27 July 2025, at 00:09.</li>
	<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="https://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3 or later</a> unless otherwise noted.</li>
<br>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="https://terms.archlinux.org/docs/privacy-policy/">Privacy policy</a></li>
	<li id="footer-places-about"><a href="../en/ArchWiki:About.html">About ArchWiki</a></li>
	<li id="footer-places-disclaimers"><a href="../en/ArchWiki:General_disclaimer.html">Disclaimers</a></li>
	<li id="footer-places-archwiki-code-of-conduct"><a href="https://terms.archlinux.org/docs/code-of-conduct/" class="extiw" title="archlinux-service-agreements:code-of-conduct">Code of conduct</a></li>
	<li id="footer-places-archwiki-terms-of-service"><a href="https://terms.archlinux.org/docs/terms-of-service/" class="extiw" title="archlinux-service-agreements:terms-of-service">Terms of service</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-copyrightico"><a href="https://www.gnu.org/copyleft/fdl.html" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.3 or later" width="88" height="31" loading="lazy"></a></li>
	<li id="footer-poweredbyico"><img src="/resources/assets/poweredby_mediawiki.svg" width="88" height="31" loading="lazy"></li>
</ul>

</footer>

		</div>
	</div> 
</div> 
<div class="vector-settings" id="p-dock-bottom">
	<ul></ul>
</div>
</body>
</html>
